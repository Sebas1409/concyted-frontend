<app-landing-header></app-landing-header>

<div class="search-page-container">
    <div class="content-wrapper">
        <h2 class="page-title">Buscador de Investigadores</h2>

        <!-- Filters Section -->
        <div class="filters-card">
            <form [formGroup]="filterForm" (ngSubmit)="search()">
                <!-- Search Input -->
                <div class="search-bar-row">
                    <div class="input-icon-wrapper">
                        <span class="search-icon">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                            </svg>
                        </span>
                        <input type="text" formControlName="searchText"
                            placeholder="Buscar por nombres, apellidos, código Renacyt o DNI..."
                            class="main-search-input" (keyup.enter)="search()">
                    </div>
                    <button type="button" class="btn-search" (click)="search()" [disabled]="isLoading">
                        <div class="button-spinner" *ngIf="isLoading"></div>
                        <span class="icon" *ngIf="!isLoading">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                            </svg>
                        </span> {{ isLoading ? 'Buscando...' : 'Buscar' }}
                    </button>
                </div>

                <!-- Dropdowns & Radios Row -->
                <div class="filters-grid">
                    <!-- Col 1: Lugar de residencia -->
                    <div class="filter-group">
                        <label>Lugar de residencia</label>
                        <select formControlName="residence" class="form-select">
                            <option value="">Seleccione...</option>
                            <option *ngFor="let dep of departments" [value]="dep.id">{{ dep.nombre }}</option>
                        </select>
                    </div>

                    <!-- Col 2: Área OCDE -->
                    <div class="filter-group">
                        <label>Área OCDE</label>
                        <select formControlName="ocdeArea" class="form-select">
                            <option value="">Seleccione...</option>
                            <option *ngFor="let area of areas" [value]="area.idArea">{{ area.descripcion }}</option>
                        </select>
                    </div>

                    <!-- Col 3: Grado Sunedu -->
                    <div class="filter-group">
                        <label>Grado Sunedu</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="checkbox" formControlName="isDoctor">
                                Doctor
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" formControlName="isMaestro">
                                Maestro
                            </label>
                        </div>
                    </div>

                    <!-- Col 4: Nacionalidad -->
                    <div class="filter-group">
                        <label>Nacionalidad</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="checkbox" formControlName="isPeruvian">
                                Peruana
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" formControlName="isForeignNat">
                                Extranjera
                            </label>
                        </div>
                    </div>
                </div>

                <div class="filters-footer">
                    <a href="javascript:void(0)" class="clear-filters" (click)="clearFilters()">Limpiar filtros</a>
                </div>

                <!-- Recaptcha Mock -->

            </form>
        </div>

        <!-- Results Section -->
        <div class="results-section">
            <h3 class="results-count" *ngIf="hasSearched">
                <span *ngIf="!isLoading">{{ totalElements }}</span>
                <span *ngIf="isLoading">...</span> Resultados encontrados
            </h3>

            <div class="results-table-card" *ngIf="hasSearched">
                <div class="table-responsive">
                    <table class="search-table">
                        <thead>
                            <tr>
                                <th class="w-num" (click)="toggleSort('id')" style="cursor: pointer;">
                                    N°
                                    <span [ngClass]="{'active': sortField === 'id'}">
                                        {{ sortField === 'id' ? (sortOrder === 'asc' ? '↑' : '↓') : '↓↑' }}
                                    </span>
                                </th>
                                <th class="w-sex" (click)="toggleSort('sexo')" style="cursor: pointer;">
                                    Sexo
                                    <span [ngClass]="{'active': sortField === 'sexo'}">
                                        {{ sortField === 'sexo' ? (sortOrder === 'asc' ? '↑' : '↓') : '↓↑' }}
                                    </span>
                                </th>
                                <th class="w-name" (click)="toggleSort('nombres')" style="cursor: pointer;">
                                    Nombre y Datos
                                    <span [ngClass]="{'active': sortField === 'nombres'}">
                                        {{ sortField === 'nombres' ? (sortOrder === 'asc' ? '↑' : '↓') : '↓↑' }}
                                    </span>
                                </th>
                                <th class="w-summary" (click)="toggleSort('resumenEjecutivo')" style="cursor: pointer;">
                                    Resumen Profesional
                                    <span [ngClass]="{'active': sortField === 'resumenEjecutivo'}">
                                        {{ sortField === 'resumenEjecutivo' ? (sortOrder === 'asc' ? '↑' : '↓') : '↓↑'
                                        }}
                                    </span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Real Results -->
                            <ng-container *ngIf="!isLoading">
                                <tr *ngFor="let item of researchers; let i = index">
                                    <td class="text-center" style="font-weight: 600; color: #1E293B;">
                                        {{ padNumber((currentPage - 1) * pageSize + i + 1) }}
                                    </td>
                                    <td class="text-center">
                                        <div [ngClass]="['sex-icon', item.gender === 'M' ? 'male' : 'female']">
                                            <!-- Mars Symbol (Male) -->
                                            <svg *ngIf="item.gender === 'M'" width="20" height="20" viewBox="0 0 24 24"
                                                fill="none" stroke="currentColor" stroke-width="2.5"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <circle cx="9" cy="15" r="6"></circle>
                                                <line x1="14" y1="10" x2="20" y2="4"></line>
                                                <polyline points="15 4 20 4 20 9"></polyline>
                                            </svg>
                                            <!-- Venus Symbol (Female) -->
                                            <svg *ngIf="item.gender === 'F'" width="20" height="20" viewBox="0 0 24 24"
                                                fill="none" stroke="currentColor" stroke-width="2.5"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <circle cx="12" cy="9" r="6"></circle>
                                                <line x1="12" y1="15" x2="12" y2="22"></line>
                                                <line x1="9" y1="19" x2="15" y2="19"></line>
                                            </svg>
                                        </div>
                                        <span
                                            style="display: block; font-size: 11px; margin-top: 6px; color: #94A3B8; font-weight: 500;">
                                            {{ item.sexName }}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="researcher-info">
                                            <a [routerLink]="['/search/researcher', item.usuarioId]" class="name-link"
                                                title="Hacer click para visualizar su detalles">
                                                <span class="icon">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                        stroke-linejoin="round">
                                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                        <circle cx="12" cy="7" r="4"></circle>
                                                    </svg>
                                                </span>
                                                {{ item.name }} ({{ item.nationality }})
                                            </a>
                                            <div class="info-row">
                                                <span class="icon">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                        stroke-linejoin="round">
                                                        <rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect>
                                                        <line x1="9" y1="22" x2="9" y2="2"></line>
                                                        <line x1="17" y1="22" x2="17" y2="2"></line>
                                                        <line x1="9" y1="18" x2="17" y2="18"></line>
                                                        <line x1="9" y1="14" x2="17" y2="14"></line>
                                                        <line x1="9" y1="10" x2="17" y2="10"></line>
                                                        <line x1="9" y1="6" x2="17" y2="6"></line>
                                                    </svg>
                                                </span>
                                                {{ item.institution }}
                                            </div>
                                            <div class="info-row">
                                                <span class="icon">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                        stroke-linejoin="round">
                                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                                        <circle cx="12" cy="10" r="3"></circle>
                                                    </svg>
                                                </span>
                                                {{ item.region }}
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <p class="summary-text"
                                            style="display: -webkit-box; -webkit-line-clamp: 3; line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">
                                            {{ item.summary }}
                                        </p>
                                    </td>
                                </tr>
                                <tr *ngIf="researchers.length === 0 && !isLoading">
                                    <td colspan="4" style="text-align: center; padding: 60px 20px;">
                                        <div class="empty-state-container"
                                            style="display: flex; flex-direction: column; align-items: center; gap: 12px;">
                                            <div class="empty-icon" style="color: #1E293B;">
                                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none"
                                                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                    stroke-linejoin="round">
                                                    <circle cx="11" cy="11" r="8"></circle>
                                                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                                    <line x1="13" y1="9" x2="9" y2="13"></line>
                                                    <line x1="9" y1="9" x2="13" y2="13"></line>
                                                </svg>
                                            </div>
                                            <h4 style="margin: 0; color: #1E293B; font-size: 1.1rem; font-weight: 700;">
                                                No
                                                encontramos coincidencias</h4>
                                            <p
                                                style="margin: 0; color: #64748B; font-size: 0.9rem; max-width: 400px; line-height: 1.5; text-align: center;">
                                                No hemos encontrado resultados para tu búsqueda. <br>
                                                Intenta limpiar los filtros o verificar a ortografía del nombre.
                                            </p>
                                        </div>
                                    </td>
                                </tr>
                            </ng-container>

                            <!-- Skeleton Loading Rows -->
                            <ng-container *ngIf="isLoading">
                                <tr *ngFor="let i of [1,2,3,4,5]">
                                    <td class="text-center">
                                        <div class="skeleton skeleton-text short"></div>
                                    </td>
                                    <td class="text-center">
                                        <div class="skeleton skeleton-circle"></div>
                                        <div class="skeleton skeleton-text xs mt-2"></div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text title mb-2"></div>
                                        <div class="skeleton skeleton-text short mb-1"></div>
                                        <div class="skeleton skeleton-text short"></div>
                                    </td>
                                    <td>
                                        <div class="skeleton skeleton-text full mb-1"></div>
                                        <div class="skeleton skeleton-text full mb-1"></div>
                                        <div class="skeleton skeleton-text full"></div>
                                    </td>
                                </tr>
                            </ng-container>
                        </tbody>
                    </table>
                </div>

                <div class="pagination" *ngIf="totalElements > 0 && hasSearched">
                    <div class="pagination-controls">
                        <div class="page-size-container">
                            <span>Mostrar</span>
                            <select class="page-size" (change)="onPageSizeChange($event)" [value]="pageSize">
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                            </select>
                            <span>elementos</span>
                        </div>

                        <div class="pages">
                            <button class="page-btn nav-btn" [disabled]="currentPage === 1"
                                (click)="changePage(currentPage - 1)">
                                Anterior
                            </button>

                            <ng-container *ngFor="let page of pagesArray">
                                <button class="page-btn" [class.active]="page === currentPage"
                                    (click)="changePage(page)">
                                    {{ page }}
                                </button>
                            </ng-container>

                            <button class="page-btn nav-btn" [disabled]="currentPage === totalPages"
                                (click)="changePage(currentPage + 1)">
                                Siguiente
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="disclaimer-alert">
                <span class="info-icon">ℹ️</span>
                <p>La información de este directorio es auto referenciada, por lo que el contenido de cada perfil es de
                    responsabilidad exclusiva de la persona inscrita; y por lo tanto, no debe ser considerado como una
                    fuente de información oficial.</p>
            </div>
        </div>

    </div>
</div>

<app-footer></app-footer>