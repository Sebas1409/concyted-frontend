<app-landing-header></app-landing-header>

<div class="search-page-container">
    <div class="content-wrapper">
        <h2 class="page-title">Buscador de Investigadores</h2>

        <!-- Filters Section -->
        <div class="filters-card">
            <form [formGroup]="filterForm" (ngSubmit)="search()">
                <!-- Search Input -->
                <div class="search-bar-row">
                    <div class="input-icon-wrapper">
                        <span class="search-icon">üîç</span>
                        <input type="text" formControlName="searchText"
                            placeholder="Buscar por nombres, apellidos, c√≥digo Renacyt o DNI..."
                            class="main-search-input">
                    </div>
                    <button type="submit" class="btn-search">
                        <span class="icon">üîç</span> Buscar
                    </button>
                </div>

                <!-- Dropdowns & Radios Row -->
                <div class="filters-grid">
                    <!-- Col 1: Lugar de residencia -->
                    <div class="filter-group">
                        <label>Lugar de residencia</label>
                        <select formControlName="residence" class="form-select">
                            <option value="">Seleccione...</option>
                            <option *ngFor="let dep of departments" [value]="dep.id">{{ dep.nombre }}</option>
                        </select>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" formControlName="isForeigner" id="chkForeigner">
                            <label for="chkForeigner">Extranjero</label>
                        </div>
                    </div>

                    <!-- Col 2: √Årea OCDE -->
                    <div class="filter-group">
                        <label>√Årea OCDE</label>
                        <select formControlName="ocdeArea" class="form-select">
                            <option value="">Seleccione...</option>
                            <option *ngFor="let area of areas" [value]="area.idArea">{{ area.descripcion }}</option>
                        </select>
                    </div>

                    <!-- Col 3: Grado Sunedu -->
                    <div class="filter-group">
                        <label>Grado Sunedu</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" formControlName="suneduGrade" value="Doctor">
                                Doctor
                            </label>
                            <label class="radio-label">
                                <input type="radio" formControlName="suneduGrade" value="Maestro">
                                Maestro
                            </label>
                        </div>
                    </div>

                    <!-- Col 4: Nacionalidad -->
                    <div class="filter-group">
                        <label>Nacionalidad</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" formControlName="nationality" value="Peruana">
                                Peruana
                            </label>
                            <label class="radio-label">
                                <input type="radio" formControlName="nationality" value="Extranjera">
                                Extranjera
                            </label>
                        </div>
                    </div>
                </div>

                <div class="filters-footer">
                    <a href="javascript:void(0)" class="clear-filters" (click)="clearFilters()">Limpiar filtros</a>
                </div>

                <!-- Recaptcha Mock -->

            </form>
        </div>

        <!-- Results Section -->
        <!-- Results Section -->
        <div class="results-section">
            <h3 class="results-count">{{ totalElements }} Resultados encontrados</h3>

            <div class="results-table-card">
                <div class="table-responsive">
                    <table class="search-table">
                        <thead>
                            <tr>
                                <th class="w-num">N¬∞ ‚Üì‚Üë</th>
                                <th class="w-sex">Sexo ‚Üì‚Üë</th>
                                <th class="w-name">Nombre y Datos ‚Üì‚Üë</th>
                                <th class="w-summary">Resumen Profesional ‚Üì‚Üë</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of researchers; let i = index">
                                <td class="text-center">{{ (currentPage - 1) * pageSize + i + 1 }}</td>
                                <td class="text-center">
                                    <div *ngIf="item.gender === 'M'" class="sex-icon male"
                                        style="color: #0EA5E9; background: #E0F2FE; width: 32px; height: 32px; border-radius: 50%; display: grid; place-items: center; margin: 0 auto;">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="5" r="3"></circle>
                                            <path d="M12 8v13M9 13l3 3 3-3"></path>
                                        </svg>
                                    </div>
                                    <div *ngIf="item.gender === 'F'" class="sex-icon female"
                                        style="color: #EC4899; background: #FCE7F3; width: 32px; height: 32px; border-radius: 50%; display: grid; place-items: center; margin: 0 auto;">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="5" r="3"></circle>
                                            <path d="M12 8v9M9 17l3 3 3-3"></path>
                                            <path d="M9 13h6"></path>
                                        </svg>
                                    </div>
                                </td>
                                <td>
                                    <div class="researcher-info">
                                        <a [routerLink]="['/search/researcher', item.id]" class="name-link"
                                            style="color: #005470; font-weight: 600; text-decoration: none;">
                                            üë§ {{ item.name }}
                                        </a>
                                        <div class="info-row" *ngIf="item.institution">
                                            <span class="icon">üèõÔ∏è</span> {{ item.institution }}
                                        </div>
                                        <div class="info-row" *ngIf="item.region">
                                            <span class="icon">üìç</span> {{ item.region }}
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="summary-text"
                                        style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; margin: 0; font-size: 13px; color: #475569;">
                                        {{ item.summary }}
                                    </p>
                                </td>
                            </tr>
                            <tr *ngIf="researchers.length === 0 && !isLoading">
                                <td colspan="4" style="text-align: center; padding: 32px; color: #64748B;">
                                    No se encontraron registros que coincidan con su b√∫squeda.
                                </td>
                            </tr>
                            <tr *ngIf="isLoading">
                                <td colspan="4" style="text-align: center; padding: 32px; color: #005470;">
                                    Cargando...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="pagination" *ngIf="totalElements > 0">
                    <div class="pagination-controls">
                        <span class="label">Mostrar</span>
                        <select class="page-size" (change)="onPageSizeChange($event)">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="20">20</option>
                        </select>
                        <span class="label">elementos</span>

                        <div class="pages">
                            <button class="page-btn" [disabled]="currentPage === 1"
                                (click)="changePage(currentPage - 1)">Anterior</button>

                            <button *ngFor="let page of pagesArray" class="page-btn"
                                [class.active]="page === currentPage" (click)="changePage(page)">
                                {{ page }}
                            </button>

                            <button class="page-btn" [disabled]="currentPage === totalPages"
                                (click)="changePage(currentPage + 1)">Siguiente</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="disclaimer-alert">
                <span class="info-icon">‚ÑπÔ∏è</span>
                <p>La informaci√≥n de este directorio es auto referenciada, por lo que el contenido de cada perfil es de
                    responsabilidad exclusiva de la persona inscrita; y por lo tanto, no debe ser considerado como una
                    fuente de informaci√≥n oficial.</p>
            </div>
        </div>

    </div>
</div>

<app-footer></app-footer>