<div class="settings-container">
    <div class="intro-section">

        <div class="description-box">
            <h4>Ajustes y Solicitudes</h4>
            <p>En esta secci칩n, puedes gestionar tus solicitudes y realizar ajustes importantes en tu cuenta, como
                cambiar
                tu contrase침a, actualizar tu informaci칩n de contacto, solicitar bajas o exportar tu curr칤culum.</p>
        </div>
    </div>

    <!-- TABS -->
    <div class="tabs-container">
        <button class="tab-btn" [class.active]="activeTab === 'settings'" (click)="setActiveTab('settings')">
            Ajustes
        </button>
        <button class="tab-btn" [class.active]="activeTab === 'export'" (click)="setActiveTab('export')">
            Exportar CV
        </button>
    </div>

    <!-- TAB: AJUSTES -->
    <div class="tab-content settings-content" *ngIf="activeTab === 'settings'">

        <!-- Section 1: Cambiar Contrase침a -->
        <div class="settings-card">
            <div class="card-left">
                <h3>Cambiar contrase침a</h3>
                <p>Datos de la cuenta de acceso al sistema</p>
            </div>
            <div class="card-right">
                <form [formGroup]="passwordForm">
                    <div class="form-group">
                        <label>Contrase침a * <span class="info-icon">?</span></label>
                        <div class="input-with-icon">
                            <input [type]="showPassword ? 'text' : 'password'" formControlName="password"
                                placeholder="XXXXXXX" appPasswordStrength #strength="appPasswordStrength">
                            <button type="button" class="btn-eye" (click)="togglePasswordVisibility()"
                                style="background:none; border:none; cursor:pointer;">
                                <svg *ngIf="!showPassword" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                    stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                <svg *ngIf="showPassword" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                    stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                                    </path>
                                    <line x1="1" y1="1" x2="23" y2="23"></line>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Confirmar contrase침a *</label>
                        <div class="input-with-icon">
                            <input [type]="showConfirmPassword ? 'text' : 'password'" formControlName="confirmPassword"
                                placeholder="XXXXXXX">
                            <button type="button" class="btn-eye" (click)="toggleConfirmPasswordVisibility()"
                                style="background:none; border:none; cursor:pointer;">
                                <svg *ngIf="!showConfirmPassword" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                    stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                <svg *ngIf="showConfirmPassword" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                    stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                                    </path>
                                    <line x1="1" y1="1" x2="23" y2="23"></line>
                                </svg>
                            </button>
                        </div>
                        <div *ngIf="passwordForm.hasError('notSame') && passwordForm.get('confirmPassword')?.dirty"
                            style="color: #DC2626; font-size: 0.8rem; margin-top: 4px;">
                            Las contrase침as no coinciden.
                        </div>
                    </div>
                </form>
                <div class="password-requirements">
                    <p [class.completed]="strength.hasMinLength">Utiliza al menos 8 caracteres para tu contrase침a.</p>
                    <p [class.completed]="strength.hasLowerCase">Incluye una letra min칰scula (a-z).</p>
                    <p [class.completed]="strength.hasUpperCase">Agrega una letra may칰scula (A-Z).</p>
                    <p [class.completed]="strength.hasSpecialChar">Al menos 1 car치cter especial (@, #, $, %, etc.).</p>
                    <p [class.completed]="strength.hasNumber">Incluye un n칰mero (0-9).</p>
                </div>
                <div class="form-actions">
                    <button class="btn-save" (click)="updatePassword()">Actualizar</button>
                </div>
            </div>
        </div>

        <!-- Section 2: Cont치ctenos -->
        <div class="settings-card">
            <div class="card-left">
                <h3>Cont치ctenos</h3>
                <p>Si desea alguna informaci칩n adicional o reportar alg칰n error, env칤enos un mensaje a trav칠s de este
                    formulario. Aseg칰rese de colocar correctamente su correo electr칩nico.</p>
                <p class="sub-text">Tambi칠n puede escribirnos al correo soporte.cti@concytec.gob.pe, o ll치menos al
                    tel칠fono (01) 399-0030 opci칩n 2:</p>
            </div>
            <div class="card-right">
                <form [formGroup]="contactForm">
                    <div class="form-row two-col">
                        <div class="form-group">
                            <label>Celular *</label>
                            <input type="text" formControlName="phone">
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" formControlName="email">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Mensaje *</label>
                        <textarea formControlName="message" rows="4"
                            placeholder="Escribe aqu칤 un breve el mensaje que nos quieres compartir"></textarea>
                    </div>
                </form>
                <div class="form-actions">
                    <button class="btn-save" (click)="sendMessage()">Actualizar</button>
                </div>
            </div>
        </div>

        <!-- Section 3: Solicitar Baja -->
        <div class="settings-card">
            <div class="card-left">
                <h3 class="danger-text">Solicitar baja</h3>
                <p>Si deseas realizar la baja de su cuenta, env칤anos un mensaje a trav칠s de este formulario.</p>
                <p class="sub-text">Luego el administrador del sistema le enviar치 a su cuenta de correo la url para la
                    confirmaci칩n de la solicitud de la baja.</p>
            </div>
            <div class="card-right">
                <form [formGroup]="deleteAccountForm">
                    <div class="form-group">
                        <label>Motivo de la solicitud de baja *</label>
                        <textarea formControlName="reason" rows="4"
                            placeholder="Escribe aqu칤 un breve el mensaje del motivo de la baja"></textarea>
                    </div>
                </form>
                <div class="form-actions">
                    <button class="btn-save" (click)="requestDelete()">Solicitar Baja</button>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB: EXPORTAR CV -->
    <div class="tab-content export-content" *ngIf="activeTab === 'export'">
        <div class="export-header">
            <div class="text">
                <h3>Seleccione los datos a exportar</h3>
                <p>Marca todas las opciones que se exportar치n dentro de tu CV En formato PDF</p>
            </div>
            <button class="btn-export-pdf" (click)="exportPdf()">Exportar en formato PDF</button>
        </div>

        <div class="export-grid">
            <!-- Card 1: Identidad -->
            <div class="export-card">
                <div class="card-header">
                    <h4>Identidad y Contacto 游깷</h4>
                </div>
                <div class="card-body">
                    <label class="checkbox-row main">
                        <input type="checkbox" [checked]="exportSections.identity.all"
                            (change)="toggleSection('identity')">
                        Todas las opciones
                    </label>
                    <label class="checkbox-row" *ngFor="let opt of exportSections.identity.options; let i = index">
                        <input type="checkbox" [checked]="opt.checked" (change)="toggleOption('identity', i)">
                        {{ opt.label }}
                    </label>
                </div>
            </div>

            <!-- Card 2: Trayectoria -->
            <div class="export-card">
                <div class="card-header">
                    <h4>Trayectoria Profesional 游깷</h4>
                </div>
                <div class="card-body">
                    <label class="checkbox-row main">
                        <input type="checkbox" [checked]="exportSections.trajectory.all"
                            (change)="toggleSection('trajectory')">
                        Todas las opciones
                    </label>
                    <label class="checkbox-row" *ngFor="let opt of exportSections.trajectory.options; let i = index">
                        <input type="checkbox" [checked]="opt.checked" (change)="toggleOption('trajectory', i)">
                        {{ opt.label }}
                    </label>
                </div>
            </div>

            <!-- Card 3: Formacion -->
            <div class="export-card">
                <div class="card-header">
                    <h4>Formaci칩n Acad칠mica 游깷</h4>
                </div>
                <div class="card-body">
                    <label class="checkbox-row main">
                        <input type="checkbox" [checked]="exportSections.formation.all"
                            (change)="toggleSection('formation')">
                        Todas las opciones
                    </label>
                    <label class="checkbox-row" *ngFor="let opt of exportSections.formation.options; let i = index">
                        <input type="checkbox" [checked]="opt.checked" (change)="toggleOption('formation', i)">
                        {{ opt.label }}
                    </label>
                </div>
            </div>

            <!-- Card 4: Produccion -->
            <div class="export-card">
                <div class="card-header">
                    <h4>Producci칩n Cient칤fica e Innovaci칩n 游깷</h4>
                </div>
                <div class="card-body">
                    <label class="checkbox-row main">
                        <input type="checkbox" [checked]="exportSections.production.all"
                            (change)="toggleSection('production')">
                        Todas las opciones
                    </label>
                    <label class="checkbox-row" *ngFor="let opt of exportSections.production.options; let i = index">
                        <input type="checkbox" [checked]="opt.checked" (change)="toggleOption('production', i)">
                        {{ opt.label }}
                    </label>
                </div>
            </div>
        </div>
    </div>
</div>