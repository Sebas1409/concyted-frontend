<div *ngIf="mode === 'default'" class="upload-area" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)" [class.dragging]="isDragging" [class.has-error]="uploadError"
    [class.has-preview]="!!previewUrl">

    <input type="file" #fileInput (change)="onFileSelected($event)" [accept]="accept" style="display: none;">

    <!-- State 1: No Image (Placeholder) -->
    <div *ngIf="!previewUrl" class="upload-placeholder">
        <div class="avatar-placeholder">{{ placeholderText }}</div>
        <div class="upload-text">
            <button class="btn-upload" (click)="fileInput.click()">Arrastra y suelta tu imagen aqu√≠ o haz clic para
                examinar</button>
            <span class="hint">{{ hintText }}</span>
        </div>
    </div>

    <!-- State 2: Image Preview -->
    <div *ngIf="previewUrl" class="image-preview" [class.has-error-image]="imageLoadFailed">
        <img *ngIf="!imageLoadFailed" [src]="previewUrl" alt="Vista previa" (error)="onImageError()">

        <!-- Fallback for broken image -->
        <div *ngIf="imageLoadFailed" class="broken-image-placeholder">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
                <line x1="3" y1="3" x2="21" y2="21" stroke="currentColor" stroke-width="2"></line>
            </svg>
            <span>Error al cargar imagen</span>
        </div>

        <div class="preview-actions">
            <button class="btn-change-image" (click)="fileInput.click()">Cambiar Imagen</button>
            <button class="btn-remove-image" (click)="removeImage()">Eliminar</button>
        </div>
    </div>
</div>

<!-- Compact Mode -->
<div *ngIf="mode === 'compact'" class="upload-compact-layout">
    <input type="file" #fileInputCompact (change)="onFileSelected($event)" [accept]="accept" style="display: none;">

    <div class="avatar-compact" [class.has-image]="!!previewUrl">
        <img *ngIf="previewUrl" [src]="previewUrl" class="avatar-img">
        <span *ngIf="!previewUrl">{{ placeholderText || 'IMG' }}</span>
    </div>

    <div class="compact-info">
        <button type="button" class="btn-outline-xs" (click)="fileInputCompact.click()">Imagen Destacada</button>
        <span class="hint">{{ hintText }}</span>
        <div *ngIf="previewUrl" style="margin-top: 4px;">
            <button (click)="removeImage()"
                style="color: #EF4444; font-size: 12px; border: none; background: none; cursor: pointer;">Eliminar
                imagen</button>
        </div>
    </div>
</div>

<div *ngIf="uploadError" class="error-message">
    {{ uploadError }}
</div>